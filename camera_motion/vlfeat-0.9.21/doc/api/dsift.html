<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
   <html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <!-- IE Standards Mode -->
  <meta content="IE=edge" http-equiv="X-UA-Compatible"></meta>
  <!-- Favicon -->
  <link href="../images/vl_blue.ico" type="image/x-icon" rel="icon"></link>
  <link href="../images/vl_blue.ico" type="image/x-icon" rel="shortcut icon"></link>
  <!-- Page title -->
  <title>VLFeat - Documentation > C API</title>
  <!-- Stylesheets -->
  <link href="../vlfeat.css" type="text/css" rel="stylesheet"></link>
  <link href="../pygmentize.css" type="text/css" rel="stylesheet"></link>
  <style xml:space="preserve">
    /* fixes a conflict between Pygmentize and MathJax */
    .MathJax .mo, .MathJax .mi {color: inherit ! important}
  </style>
  <link rel="stylesheet" type="text/css" href="doxygen.css"></link>
<link rel="stylesheet" type="text/css" href="tabs.css"></link>
  <!-- Scripts-->
  <script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
  <!-- MathJax -->
  <script xml:space="preserve" type="text/x-mathjax-config">
    MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      processEscapes: true,
    },
    TeX: {
      Macros: {
        balpha: '\\boldsymbol{\\alpha}',
        bc: '\\mathbf{c}',
        be: '\\mathbf{e}',
        bg: '\\mathbf{g}',
        bq: '\\mathbf{q}',
        bu: '\\mathbf{u}',
        bv: '\\mathbf{v}',
        bw: '\\mathbf{w}',
        bx: '\\mathbf{x}',
        by: '\\mathbf{y}',
        bz: '\\mathbf{z}',
        bsigma: '\\mathbf{\\sigma}',
        sign: '\\operatorname{sign}',
        diag: '\\operatorname{diag}',
        real: '\\mathbb{R}',
      },
      equationNumbers: { autoNumber: 'AMS' }
      }
    });
  </script>
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" xml:space="preserve" type="text/javascript"></script>
  <!-- Google Custom Search -->
  <script xml:space="preserve">
    (function() {
    var cx = '003215582122030917471:oq23albfeam';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https' ? 'https:' : 'http:') +
    '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
    })();
  </script>
  <!-- Google Analytics -->
  <script xml:space="preserve" type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4936091-2']);
    _gaq.push(['_trackPageview']);
    (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
 </head>
 <!-- Body Start -->
 <body>
  <div id="header-section">
    <div id="header">
      <!-- Google CSE Search Box -->
      <div class="searchbox">
        <gcse:searchbox-only autoCompleteMaxCompletions="5" autoCompleteMatchType="any" resultsUrl="http://www.vlfeat.org/search.html"></gcse:searchbox-only>
      </div>
      <h1 id="id-16"><a shape="rect" href="../index.html" class="plain"><span id="vlfeat">VLFeat</span><span id="dotorg">.org</span></a></h1>
    </div>
    <div id="sidebar"> <!-- Navigation Start -->
      <ul>
<li><a href="../index.html">Home</a>
<ul>
<li><a href="../about.html">About</a>
</li>
<li><a href="../license.html">License</a>
</li>
</ul></li>
<li><a href="../download.html">Download</a>
<ul>
<li><a href="../install-matlab.html">Using from MATLAB</a>
</li>
<li><a href="../install-octave.html">Using from Octave</a>
</li>
<li><a href="../install-shell.html">Using from the command line</a>
</li>
<li><a href="../install-c.html">Using from C</a>
<ul>
<li><a href="../xcode.html">Xcode</a>
</li>
<li><a href="../vsexpress.html">Visual C++</a>
</li>
<li><a href="../gcc.html">g++</a>
</li>
</ul></li>
<li><a href="../compiling.html">Compiling</a>
<ul>
<li><a href="../compiling-unix.html">Compiling on UNIX-like platforms</a>
</li>
<li><a href="../compiling-windows.html">Compiling on Windows</a>
</li>
</ul></li>
</ul></li>
<li><a href="../overview/tut.html">Tutorials</a>
<ul>
<li><a href="../overview/frame.html">Local feature frames</a>
</li>
<li><a href="../overview/covdet.html">Covariant feature detectors</a>
</li>
<li><a href="../overview/hog.html">HOG features</a>
</li>
<li><a href="../overview/sift.html">SIFT detector and descriptor</a>
</li>
<li><a href="../overview/dsift.html">Dense SIFT</a>
</li>
<li><a href="../overview/liop.html">LIOP local descriptor</a>
</li>
<li><a href="../overview/mser.html">MSER feature detector</a>
</li>
<li><a href="../overview/imdisttf.html">Distance transform</a>
</li>
<li><a href="../overview/encodings.html">Fisher Vector and VLAD</a>
</li>
<li><a href="../overview/gmm.html">Gaussian Mixture Models</a>
</li>
<li><a href="../overview/kmeans.html">K-means clustering</a>
</li>
<li><a href="../overview/aib.html">Agglomerative Infromation Bottleneck</a>
</li>
<li><a href="../overview/quickshift.html">Quick shift superpixels</a>
</li>
<li><a href="../overview/slic.html">SLIC superpixels</a>
</li>
<li><a href="../overview/svm.html#tut.svm">Support Vector Machines (SVMs)</a>
</li>
<li><a href="../overview/kdtree.html">KD-trees and forests</a>
</li>
<li><a href="../overview/plots-rank.html">Plotting AP and ROC curves</a>
</li>
<li><a href="../overview/utils.html">Miscellaneous utilities</a>
</li>
<li><a href="../overview/ikm.html">Integer K-means</a>
</li>
<li><a href="../overview/hikm.html">Hierarchical integer k-means</a>
</li>
</ul></li>
<li><a href="../applications/apps.html">Applications</a>
</li>
<li class='active'><a href="../doc.html">Documentation</a>
<ul>
<li><a href="../matlab/matlab.html">MATLAB API</a>
</li>
<li class='active' class='activeLeaf'><a href="index.html">C API</a>
</li>
<li><a href="../man/man.html">Man pages</a>
</li>
</ul></li>
</ul>
    </div> <!-- sidebar -->
  </div>
  <div id="headbanner-section">
    <div id="headbanner">
      <span class='page'><a href="../doc.html">Documentation</a></span><span class='separator'>></span><span class='page'><a href="index.html">C API</a></span>
    </div>
  </div>
  <div id="content-section">
    <div id="content-wrapper">
      <div id="content">
      <!-- <pagestyle href="%pathto:root;api/tabs.css"/> -->
      <div class="doxygen">
<div id="top">
<div id="top">
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Vision Lab Features Library (VLFeat)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Dense Scale Invariant Feature Transform (DSIFT) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#dsift-intro">Overview</a></li>
<li class="level1"><a href="#dsift-usage">Usage</a></li>
<li class="level1"><a href="#dsift-tech">Technical details</a><ul><li class="level2"><a href="#dsift-tech-descriptor-dense">Dense descriptors</a></li>
<li class="level2"><a href="#dsift-tech-sampling">Sampling</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Andrea Vedaldi </dd>
<dd>
Brian Fulkerson</dd></dl>
<p><a class="el" href="dsift_8h.html">dsift.h</a> implements a dense version of <a class="el" href="sift_8h.html">SIFT</a>. This is an object that can quickly compute descriptors for densely sampled keypoints with identical size and orientation. It can be reused for multiple images of the same size.</p>
<h1><a class="anchor" id="dsift-intro"></a>
Overview</h1>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="sift.html">The SIFT module</a>, <a class="el" href="dsift.html#dsift-tech">Technical details</a></dd></dl>
<p>This module implements a fast algorithm for the calculation of a large number of SIFT descriptors of densely sampled features of the same scale and orientation. See the <a class="el" href="sift.html">SIFT module</a> for an overview of SIFT.</p>
<p>The feature frames (keypoints) are indirectly specified by the sampling steps (<a class="el" href="dsift_8h.html#a42ae6bf77a9b737fd1e45ad5c43263dd" title="Set steps. ">vl_dsift_set_steps</a>) and the sampling bounds (<a class="el" href="dsift_8h.html#a7d34c8e257c873f2ed580b046296d1ac" title="Set bounds. ">vl_dsift_set_bounds</a>). The descriptor geometry (number and size of the spatial bins and number of orientation bins) can be customized (<a class="el" href="dsift_8h.html#a930f20c25eab08d9490830b0a358ff2b" title="Set SIFT descriptor geometry. ">vl_dsift_set_geometry</a>, <a class="el" href="structVlDsiftDescriptorGeometry.html" title="Dense SIFT descriptor geometry. ">VlDsiftDescriptorGeometry</a>).</p>
<div class="image">
<img src="dsift-geom.png" alt="dsift-geom.png"/>
<div class="caption">
Dense SIFT descriptor geometry</div></div>
<p> By default, SIFT uses a Gaussian windowing function that discounts contributions of gradients further away from the descriptor centers. This function can be changed to a flat window by invoking <a class="el" href="dsift_8h.html#a8dfe2d20dbe9885d0c139c5b81b5f4b0" title="Set flat window flag. ">vl_dsift_set_flat_window</a>. In this case, gradients are accumulated using only bilinear interpolation, but instad of being reweighted by a Gassuain window, they are all weighted equally. However, after gradients have been accumulated into a spatial bin, the whole bin is reweighted by the average of the Gaussian window over the spatial support of that bin. This &ldquo;approximation&rdquo; substantially improves speed with little or no loss of performance in applications.</p>
<p>Keypoints are sampled in such a way that the centers of the spatial bins are at integer coordinates within the image boundaries. For instance, the top-left bin of the top-left descriptor is centered on the pixel (0,0). The bin immediately to the right at (<code>binSizeX</code>,0), where <code>binSizeX</code> is a paramtere in the <a class="el" href="structVlDsiftDescriptorGeometry.html" title="Dense SIFT descriptor geometry. ">VlDsiftDescriptorGeometry</a> structure. <a class="el" href="dsift_8h.html#a7d34c8e257c873f2ed580b046296d1ac" title="Set bounds. ">vl_dsift_set_bounds</a> can be used to further restrict sampling to the keypoints in an image.</p>
<h1><a class="anchor" id="dsift-usage"></a>
Usage</h1>
<p>DSIFT is implemented by a <a class="el" href="structVlDsiftFilter.html" title="Dense SIFT filter. ">VlDsiftFilter</a> object that can be used to process a sequence of images of a given geometry. To use the <b>DSIFT filter</b>:</p>
<ul>
<li>Initialize a new DSIFT filter object by <a class="el" href="dsift_8c.html#aa9ba7ffaa72c137c457642ce833dab05" title="Create a new DSIFT filter. ">vl_dsift_new</a> (or the simplified <a class="el" href="dsift_8c.html#aa025e58a852d8df078c6b74b8136c704" title="Create a new DSIFT filter (basic interface) ">vl_dsift_new_basic</a>). Customize the descriptor parameters by <a class="el" href="dsift_8h.html#a42ae6bf77a9b737fd1e45ad5c43263dd" title="Set steps. ">vl_dsift_set_steps</a>, <a class="el" href="dsift_8h.html#a930f20c25eab08d9490830b0a358ff2b" title="Set SIFT descriptor geometry. ">vl_dsift_set_geometry</a>, etc.</li>
<li>Process an image by <a class="el" href="dsift_8c.html#a09d5525ad7e16e2b9f3f1b9d273c85f6" title="Compute keypoints and descriptors. ">vl_dsift_process</a>.</li>
<li>Retrieve the number of keypoints (<a class="el" href="dsift_8h.html#a3b5fabb1496fc91a70669d4201f47a5b" title="Get number of keypoints. ">vl_dsift_get_keypoint_num</a>), the keypoints (<a class="el" href="dsift_8h.html#a5b586c60d079a65ded73c4fd2387d6bf" title="Get keypoints. ">vl_dsift_get_keypoints</a>), and their descriptors (<a class="el" href="dsift_8h.html#a06f036e38fb68d2237dd60efb6f21236" title="Get descriptors. ">vl_dsift_get_descriptors</a>).</li>
<li>Optionally repeat for more images.</li>
<li>Delete the DSIFT filter by <a class="el" href="dsift_8c.html#aa123f1d9e79ab01882646f713dfb4f0c" title="Delete DSIFT filter. ">vl_dsift_delete</a>.</li>
</ul>
<h1><a class="anchor" id="dsift-tech"></a>
Technical details</h1>
<p>This section extends the <a class="el" href="sift.html#sift-tech-descriptor">SIFT descriptor section</a> and specialzies it to the case of dense keypoints.</p>
<h2><a class="anchor" id="dsift-tech-descriptor-dense"></a>
Dense descriptors</h2>
<p>When computing descriptors for many keypoints differing only by their position (and with null rotation), further simplifications are possible. In this case, in fact,</p>
<p class="formulaDsp">
\begin{eqnarray*} \mathbf{x} &amp;=&amp; m \sigma \hat{\mathbf{x}} + T,\\ h(t,i,j) &amp;=&amp; m \sigma \int g_{\sigma_\mathrm{win}}(\mathbf{x} - T)\, w_\mathrm{ang}(\angle J(\mathbf{x}) - \theta_t)\, w\left(\frac{x - T_x}{m\sigma} - \hat{x}_i\right)\, w\left(\frac{y - T_y}{m\sigma} - \hat{y}_j\right)\, |J(\mathbf{x})|\, d\mathbf{x}. \end{eqnarray*}
</p>
<p>Since many different values of <em>T</em> are sampled, this is conveniently expressed as a separable convolution. First, we translate by \( \mathbf{x}_{ij} = m\sigma(\hat x_i,\ \hat y_i)^\top \) and we use the symmetry of the various binning and windowing functions to write</p>
<p class="formulaDsp">
\begin{eqnarray*} h(t,i,j) &amp;=&amp; m \sigma \int g_{\sigma_\mathrm{win}}(T&#39; - \mathbf{x} - \mathbf{x}_{ij})\, w_\mathrm{ang}(\angle J(\mathbf{x}) - \theta_t)\, w\left(\frac{T&#39;_x - x}{m\sigma}\right)\, w\left(\frac{T&#39;_y - y}{m\sigma}\right)\, |J(\mathbf{x})|\, d\mathbf{x}, \\ T&#39; &amp;=&amp; T + m\sigma \left[\begin{array}{cc} x_i \\ y_j \end{array}\right]. \end{eqnarray*}
</p>
<p>Then we define kernels</p>
<p class="formulaDsp">
\begin{eqnarray*} k_i(x) &amp;=&amp; \frac{1}{\sqrt{2\pi} \sigma_{\mathrm{win}}} \exp\left( -\frac{1}{2} \frac{(x-x_i)^2}{\sigma_{\mathrm{win}}^2} \right) w\left(\frac{x}{m\sigma}\right), \\ k_j(y) &amp;=&amp; \frac{1}{\sqrt{2\pi} \sigma_{\mathrm{win}}} \exp\left( -\frac{1}{2} \frac{(y-y_j)^2}{\sigma_{\mathrm{win}}^2} \right) w\left(\frac{y}{m\sigma}\right), \end{eqnarray*}
</p>
<p>and obtain</p>
<p class="formulaDsp">
\begin{eqnarray*} h(t,i,j) &amp;=&amp; (k_ik_j * \bar J_t)\left( T + m\sigma \left[\begin{array}{cc} x_i \\ y_j \end{array}\right] \right), \\ \bar J_t(\mathbf{x}) &amp;=&amp; w_\mathrm{ang}(\angle J(\mathbf{x}) - \theta_t)\,|J(\mathbf{x})|. \end{eqnarray*}
</p>
<p>Furthermore, if we use a flat rather than Gaussian windowing function, the kernels do not depend on the bin, and we have</p>
<p class="formulaDsp">
\begin{eqnarray*} k(z) &amp;=&amp; \frac{1}{\sigma_{\mathrm{win}}} w\left(\frac{z}{m\sigma}\right), \\ h(t,i,j) &amp;=&amp; (k(x)k(y) * \bar J_t)\left( T + m\sigma \left[\begin{array}{cc} x_i \\ y_j \end{array}\right] \right), \end{eqnarray*}
</p>
<p>(here \( \sigma_\mathrm{win} \) is the side of the flat window).</p>
<dl class="section note"><dt>Note</dt><dd>In this case the binning functions \( k(z) \) are triangular and the convolution can be computed in time independent on the filter (i.e. descriptor bin) support size by integral signals.</dd></dl>
<h2><a class="anchor" id="dsift-tech-sampling"></a>
Sampling</h2>
<p>To avoid resampling and dealing with special boundary conditions, we impose some mild restrictions on the geometry of the descriptors that can be computed. In particular, we impose that the bin centers \( T + m\sigma (x_i,\ y_j) \) are always at integer coordinates within the image boundaries. This eliminates the need for costly interpolation. This condition amounts to (expressed in terms of the <em>x</em> coordinate, and equally applicable to <em>y</em>)</p>
<p class="formulaDsp">
\[ \{0,\dots, W-1\} \ni T_x + m\sigma x_i = T_x + m\sigma i - \frac{N_x-1}{2} = \bar T_x + m\sigma i, \qquad i = 0,\dots,N_x-1. \]
</p>
<p>Notice that for this condition to be satisfied, the <em>descriptor</em> center \( T_x \) needs to be either fractional or integer depending on \( N_x \) being even or odd. To eliminate this complication, it is simpler to use as a reference not the descriptor center <em>T</em>, but the coordinates of the upper-left bin \( \bar T \). Thus we sample the latter on a regular (integer) grid</p>
<p class="formulaDsp">
\[ \left[\begin{array}{cc} 0 \\ 0 \end{array}\right] \leq \bar T = \left[\begin{array}{cc} \bar T_x^{\min} + p \Delta_x \\ \bar T_y^{\min} + q \Delta_y \\ \end{array}\right] \leq \left[\begin{array}{cc} W - 1 - m\sigma N_x \\ H - 1 - m\sigma N_y \end{array}\right], \quad \bar T = \left[\begin{array}{cc} T_x - \frac{N_x - 1}{2} \\ T_y - \frac{N_y - 1}{2} \\ \end{array}\right] \]
</p>
<p>and we impose that the bin size \( m \sigma \) is integer as well. </p>
</div></div><!-- contents -->
        <!-- Doc Here -->
      </div>
      </div>
      <div class="clear">&nbsp;</div>
    </div>
  </div> <!-- content-section -->
  <div id="footer-section">
    <div id="footer">
      &copy; 2007-14,18 The VLFeat Authors
    </div> <!-- footer -->
  </div> <!-- footer section -->
 </body>
 <!-- Body ends -->
</html>
