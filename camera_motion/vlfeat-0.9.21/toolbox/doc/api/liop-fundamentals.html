<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
   <html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <!-- IE Standards Mode -->
  <meta content="IE=edge" http-equiv="X-UA-Compatible"></meta>
  <!-- Favicon -->
  <link href="../images/vl_blue.ico" type="image/x-icon" rel="icon"></link>
  <link href="../images/vl_blue.ico" type="image/x-icon" rel="shortcut icon"></link>
  <!-- Page title -->
  <title>VLFeat - Documentation > C API</title>
  <!-- Stylesheets -->
  <link href="../vlfeat.css" type="text/css" rel="stylesheet"></link>
  <link href="../pygmentize.css" type="text/css" rel="stylesheet"></link>
  <style xml:space="preserve">
    /* fixes a conflict between Pygmentize and MathJax */
    .MathJax .mo, .MathJax .mi {color: inherit ! important}
  </style>
  <link rel="stylesheet" type="text/css" href="doxygen.css"></link>
<link rel="stylesheet" type="text/css" href="tabs.css"></link>
  <!-- Scripts-->
  <script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
  <!-- MathJax -->
  <script xml:space="preserve" type="text/x-mathjax-config">
    MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      processEscapes: true,
    },
    TeX: {
      Macros: {
        balpha: '\\boldsymbol{\\alpha}',
        bc: '\\mathbf{c}',
        be: '\\mathbf{e}',
        bg: '\\mathbf{g}',
        bq: '\\mathbf{q}',
        bu: '\\mathbf{u}',
        bv: '\\mathbf{v}',
        bw: '\\mathbf{w}',
        bx: '\\mathbf{x}',
        by: '\\mathbf{y}',
        bz: '\\mathbf{z}',
        bsigma: '\\mathbf{\\sigma}',
        sign: '\\operatorname{sign}',
        diag: '\\operatorname{diag}',
        real: '\\mathbb{R}',
      },
      equationNumbers: { autoNumber: 'AMS' }
      }
    });
  </script>
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" xml:space="preserve" type="text/javascript"></script>
  <!-- Google Custom Search -->
  <script xml:space="preserve">
    (function() {
    var cx = '003215582122030917471:oq23albfeam';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https' ? 'https:' : 'http:') +
    '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
    })();
  </script>
  <!-- Google Analytics -->
  <script xml:space="preserve" type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4936091-2']);
    _gaq.push(['_trackPageview']);
    (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
 </head>
 <!-- Body Start -->
 <body>
  <div id="header-section">
    <div id="header">
      <!-- Google CSE Search Box -->
      <div class="searchbox">
        <gcse:searchbox-only autoCompleteMaxCompletions="5" autoCompleteMatchType="any" resultsUrl="http://www.vlfeat.org/search.html"></gcse:searchbox-only>
      </div>
      <h1 id="id-16"><a shape="rect" href="../index.html" class="plain"><span id="vlfeat">VLFeat</span><span id="dotorg">.org</span></a></h1>
    </div>
    <div id="sidebar"> <!-- Navigation Start -->
      <ul>
<li><a href="../index.html">Home</a>
<ul>
<li><a href="../about.html">About</a>
</li>
<li><a href="../license.html">License</a>
</li>
</ul></li>
<li><a href="../download.html">Download</a>
<ul>
<li><a href="../install-matlab.html">Using from MATLAB</a>
</li>
<li><a href="../install-octave.html">Using from Octave</a>
</li>
<li><a href="../install-shell.html">Using from the command line</a>
</li>
<li><a href="../install-c.html">Using from C</a>
<ul>
<li><a href="../xcode.html">Xcode</a>
</li>
<li><a href="../vsexpress.html">Visual C++</a>
</li>
<li><a href="../gcc.html">g++</a>
</li>
</ul></li>
<li><a href="../compiling.html">Compiling</a>
<ul>
<li><a href="../compiling-unix.html">Compiling on UNIX-like platforms</a>
</li>
<li><a href="../compiling-windows.html">Compiling on Windows</a>
</li>
</ul></li>
</ul></li>
<li><a href="../overview/tut.html">Tutorials</a>
<ul>
<li><a href="../overview/frame.html">Local feature frames</a>
</li>
<li><a href="../overview/covdet.html">Covariant feature detectors</a>
</li>
<li><a href="../overview/hog.html">HOG features</a>
</li>
<li><a href="../overview/sift.html">SIFT detector and descriptor</a>
</li>
<li><a href="../overview/dsift.html">Dense SIFT</a>
</li>
<li><a href="../overview/liop.html">LIOP local descriptor</a>
</li>
<li><a href="../overview/mser.html">MSER feature detector</a>
</li>
<li><a href="../overview/imdisttf.html">Distance transform</a>
</li>
<li><a href="../overview/encodings.html">Fisher Vector and VLAD</a>
</li>
<li><a href="../overview/gmm.html">Gaussian Mixture Models</a>
</li>
<li><a href="../overview/kmeans.html">K-means clustering</a>
</li>
<li><a href="../overview/aib.html">Agglomerative Infromation Bottleneck</a>
</li>
<li><a href="../overview/quickshift.html">Quick shift superpixels</a>
</li>
<li><a href="../overview/slic.html">SLIC superpixels</a>
</li>
<li><a href="../overview/svm.html#tut.svm">Support Vector Machines (SVMs)</a>
</li>
<li><a href="../overview/kdtree.html">KD-trees and forests</a>
</li>
<li><a href="../overview/plots-rank.html">Plotting AP and ROC curves</a>
</li>
<li><a href="../overview/utils.html">Miscellaneous utilities</a>
</li>
<li><a href="../overview/ikm.html">Integer K-means</a>
</li>
<li><a href="../overview/hikm.html">Hierarchical integer k-means</a>
</li>
</ul></li>
<li><a href="../applications/apps.html">Applications</a>
</li>
<li class='active'><a href="../doc.html">Documentation</a>
<ul>
<li><a href="../matlab/matlab.html">MATLAB API</a>
</li>
<li class='active' class='activeLeaf'><a href="index.html">C API</a>
</li>
<li><a href="../man/man.html">Man pages</a>
</li>
</ul></li>
</ul>
    </div> <!-- sidebar -->
  </div>
  <div id="headbanner-section">
    <div id="headbanner">
      <span class='page'><a href="../doc.html">Documentation</a></span><span class='separator'>></span><span class='page'><a href="index.html">C API</a></span>
    </div>
  </div>
  <div id="content-section">
    <div id="content-wrapper">
      <div id="content">
      <!-- <pagestyle href="%pathto:root;api/tabs.css"/> -->
      <div class="doxygen">
<div id="top">
<div id="top">
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Vision Lab Features Library (VLFeat)</a></li><li class="navelem"><a class="el" href="liop.html">Local Intensity Order Pattern (LIOP) descriptor</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">LIOP fundamentals </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#liop-spatial-binning">Intensity rank spatial binning</a></li>
<li class="level1"><a href="#liop-weighing">Weighted pooling</a></li>
<li class="level1"><a href="#liop-normalization">Normalization</a></li>
</ul>
</div>
<div class="textblock"><p>The <em>Local Invariant Order Pattern</em> (LIOP) descriptor <a class="el" href="citelist.html#CITEREF_wang11local">[32]</a> is a local image descriptor based on the concept of local order pattern*. An order pattern is simply the order obtained by sorting selected image samples by increasing intensity. Consider in particular a pixel \(\bx\) and \(n\) neighbors \(\bx_1,\bx_2,\dots,\bx_n\). The local order pattern at \(\bx\) is the permutation \(\sigma\) that sorts the neighbours by increasing intensity \(I(\bx_{\sigma(1)}) \leq I(\bx_{\sigma(2)}) \leq \dots \leq I(\bx_{\sigma(2)})\).</p>
<p>An advantage of order patterns is that they are invariant to monotonic changes of the image intensity. However, an order pattern describes only a small portion of a patch and is not very distinctive. LIOP assembles local order patterns computed at all image locations to obtain a descriptor that at the same time distinctive and invariant to monotonic intensity changes as well as image rotations.</p>
<p>In order to make order patterns rotation invariant, the neighborhood of samples around \(\bx\) is taken in a rotation-covariant manner. In particular, the points \(\bx_1,\dots,\bx_n\) are sampled anticlockwise on a circle of radius \(r\) around \(\bx\), as shown in the following figure:</p>
<div class="image">
<img src="liop.png" alt="liop.png"/>
<div class="caption">
LIOP descriptor layout: square input patch (shaded area), circular measurement region (white area), local neighborhood of a point (blue).</div></div>
<p> Since the sample points do not necessarily have integer coordinates, \(I(\bx_i)\) is computed using bilinear interpolation.</p>
<h1><a class="anchor" id="liop-spatial-binning"></a>
Intensity rank spatial binning</h1>
<p>Once local order patterns are computed for all pixels \(\bx\) in the image, they can be pooled into a histogram to form an image descriptor. Pooling discards spatial information resulting in a warp-invariant statistics. In practice, there are two restriction on which pixels can be used for this purpose:</p>
<ul>
<li>A margin of \(r\) pixels from the image boundary must be maintained so that neighborhoods fall within the image boundaries.</li>
<li>Rotation invariance requires the pooling regions to be rotation co-variant. A way to do so is to make the shape of the pooling region rotation invariant.</li>
</ul>
<p>For this reason, the histogram pooling region is restricted to the circular region shown with a light color in the figure above.</p>
<p>In order to increase distinctiveness of the descriptor, LIOP pools multiple histograms from a number of regions \(R_1,\dots,R_m\) (spatial pooling). These regions are selected in an illumination-invariant and rotation-covariant manner by looking at level sets: </p><p class="formulaDsp">
\[ R_t = \{\bx :\tau_{t} \leq I(\bx) &lt; \tau_{t+1} \}. \]
</p>
<p> In order to be invariant to monotonic changes of the intensity, the thresholds \(\tau_t\) are selected so that all regions contain the same number of pixels. This can be done efficiently by sorting pixels by increasing intensity and then partitioning the resulting list into \(m\) equal parts (when \(m\) does not divide the number of pixels exactly, the remaining pixels are incorporated into the last partition).</p>
<h1><a class="anchor" id="liop-weighing"></a>
Weighted pooling</h1>
<p>In order to compute a histogram of order pattern occurrences, one needs to map permutations to histogram bins. This is obtained by sorting permutation in lexycogrpahical order. For example, for \(n=4\) neighbors one has the following \(n!=24\) permutations:</p>
<table class="doxtable">
<tr>
<th>Permutation </th><th>Lexycographical rank  </th></tr>
<tr>
<td>1 2 3 4 </td><td>1 </td></tr>
<tr>
<td>1 2 4 3 </td><td>2 </td></tr>
<tr>
<td>1 3 2 4 </td><td>3 </td></tr>
<tr>
<td>1 3 4 2 </td><td>4 </td></tr>
<tr>
<td>... </td><td>... </td></tr>
<tr>
<td>4 3 1 2 </td><td>23 </td></tr>
<tr>
<td>4 3 2 1 </td><td>24 </td></tr>
</table>
<p>In the following, \(q(\bx) \in [1, n!]\) will denote the index of the local order pattern \(\sigma\) centered at pixel \(\bx\).</p>
<p>The local order patterns \(q(\bx)\) in a region \(R_t\) are then pooled to form a histogram of size \(!n\). In this process, patterns are weighted based on their stability. The latter is assumed to be proportional to the number of pairs of pixels in the neighborhood that have a sufficiently large intensity difference:</p>
<p class="formulaDsp">
\[ w(\bx) = \sum_{i=1}^n \sum_{j=1}^n [ |I(\bx_{i}) - I(\bx_{j})| &gt; \Theta) ] \]
</p>
<p>where \([\cdot]\) is the indicator function.</p>
<p>In VLFeat LIOP implementation, the threshold \(\Theta\) is either set as an absolute value, or as a faction of the difference between the maximum and minimum intensity in the image (restricted to the pixels in the light area in the figure above).</p>
<p>Overall, LIOP consists of \(m\) histograms of size \(n!\) obtained as</p>
<p class="formulaDsp">
\[ h_{qt} = \sum_{\bx : q(\bx) = q \ \wedge\ \bx \in R_t} w(\bx). \]
</p>
<h1><a class="anchor" id="liop-normalization"></a>
Normalization</h1>
<p>After computing the weighted counts \(h_{qt}\), the LIOP descriptor is obtained by stacking the values \(\{h_{qt}\}\) into a vector \(\mathbf{h}\) and then normalising it:</p>
<p class="formulaDsp">
\[ \Phi = \frac{\mathbf{h}}{\|\mathbf{h}\|_2} \]
</p>
<p>The dimensionality is therefore \(m n!\), where \(m\) is the <code>numSpatialBins</code> number of spatial bins and \(n\) is the <code>numNeighbours</code> number of neighbours (see <a class="el" href="liop_8c.html#a58f0187de91697299f22036831453a9e" title="Create a new LIOP object instance. ">vl_liopdesc_new</a>). By default, this descriptor is stored in <code>single</code> format. It can be stored as a sequence of bytes by premultiplying the values by the constant 255 and then rounding:</p>
<p class="formulaDsp">
\[ \operatorname{round}\left[ 255\, \times \Phi\right]. \]
</p>
 </div></div><!-- contents -->
        <!-- Doc Here -->
      </div>
      </div>
      <div class="clear">&nbsp;</div>
    </div>
  </div> <!-- content-section -->
  <div id="footer-section">
    <div id="footer">
      &copy; 2007-14,18 The VLFeat Authors
    </div> <!-- footer -->
  </div> <!-- footer section -->
 </body>
 <!-- Body ends -->
</html>
